## Γραμμική ανάλυση 2ης χρονοσειράς

Η δεύτερη χρονοσειρά όπως φαίνεται από το διαγραμμά της φαίνεται ότι έχει κάποια ανοδική τάση. Οπότε μάλλον το άτομο εδώ μπορεί και ακολουθεί την γραμμή και πρόκειται πραγματικά για υγιές άτομο (αυτό θα φανεί και αργότερα, αλλά χωρίς επαρκή ανάλυση δεν θα μπορούσαμε να υποστηρίξουμε κάτι τέτοιο). Επίσης, σίγουρα δεν υπάρχει μόνο θόρυβος. Από αυτά εκτιμάμε ότι η χρονοσειρά έχει πληροφορία που χαρακτηρίζει τον ασθενή. Στο Σχήμα [14] φαίνονται σε χρονική σειρά οι 6000 τιμές του σήματος που λάβαμε από το δεύτερο πείραμα.

![Χρονοσειρά 2](../assets/basic_plot_2nd.png "Χρονοσειρά 2"){ width=75% height=75% }

Στη μελέτη αυτής της γραμμικής μελέτης αυτής της χρονοσειράς, χρησιμοποιούμε τα εργαλεία του μαθήματος και συγκρίνουμε τη μελέτη με αυτή της πρώτης. Επίσης παραλείπουμε εξηγήσεις οι οποίες είναι ίδιες με την πρώτη.

### Εξαγωγή χρονοσειράς μελέτης

Με βάση τη συνάρτηση `extremes.m` που μας δόθηκε εξάγαμε και πάλι όλες τις χρονοσειρές των τοπικών ακροτάτων που μπορεί κανείς να τις δει στα Σχήματα [15] και [16]. Επίσης, δίνονται και τα ορίσματα της συνάρτησης `extremes` τα οποία εξάγαμε μετά από αρκετό πειραματισμό.

```matlab
filterorder = 5;
nsam = 5;
timesep = 5;
``` 
Όπως και στην πρώτη χρονοσειρά, έτσι και εδώ ενδιαφερόμαστε περισσότερο για τις χρονοσειρές `AMA` και `TMI`. Μετά από ελέγχους ύπαρξης πληροφορίας Portmanteu καταλήγουμε και πάλι ότι αυτές οι δύο έχουν πληροφορία και δεν προσεγγίζονται μόνο από τον λευκό θόρυβο.

![Χρονοσειρές πλάτους](../assets/AM_plot_2nd.png  "Χρονοσειρές πλάτους"){ width=75% height=75% }


![Χρονοσειρές χρόνου χρόνου εμφάνισης μεγίστων](../assets/TM_plot_2nd.png "Χρονοσειρές χρόνου"){ width=75% height=75% }

### Κυρίως γραμμική ανάλυση

#### AMA

Στο πρώτο μέρος της γραμμικής ανάλυσης θα αναφερθούμε στη χρονοσειρά AMA που εξάγαμε. Το πρώτο μέγεθος που υπολογίσαμε για αυτήν ήταν η τάση της. Αυτό το κάναμε χρησιμοποιώντας πάλι ένα πολυώνυμο. Το τελικό πολυώνυμο έδειξε ότι η σταθερός όρος της τάσης είναι ίσος με `-7.7080776`ενώ ο γραμμικός συντελεστής της `0.33391515`. Οι υπόλοιποι 3 συντελεστές αυτού του πολυωνύμου ωστόσο δεν ακυρώνουν την γραμμική τάση μετά από λίγα χρονικά βήματα όπως στην πρώτη χρονοσειρά. Δηλαδή επιβεβαιώνουν την ύπαρξη ανοδικής τάσης.

Μετά υπολογίσαμε και κάναμε τα γραφήματα της συνάρτησης αυτοσυσχέτισης και μερικής αυτοσυσχέτισης. Στα σχήματα [17] και [18] φαίνονται τα διαγράμματα αυτά.

![Συνάρτηση αυτοσυσχέτισης](../assets/autocorrelation_AMA2.png "Συνάρτηση αυτοσυσχέτισης"){ width=75% height=75% }

![Συνάρτηση μερικής αυτοσυσχέτισης](../assets/partial_autocorrelations_AMA2.png "Συνάρτηση μερικής αυτοσυσχέτισης"){ width=75% height=75% }

Από τις αυτοσυσχετίσεις βλέπουμε ότι τα δεδομένα έχουν έμμεση συσχέτιση μέχρι και μεγάλες τιμές του $\tau$. Ωστόσο, οι μερικές αυτοσυσχετίσεις δείχνουν ότι οι μακρινές (σε χρονικά βήματα) τιμές δεν είναι άμεσα συσχετιζόμενες με την τωρινή. Αυτή είναι και μία μεγάλη ομοιότητα μεταξύ αυτής της AMA χρονοσειράς και της πρώτης AMA χρονοσειράς. Η πρώτη φαινόταν να έχει πιο ισχυρές πρώτες μερικές αυτοσυσχετίσεις και αυτοσυσχετίσεις.

Παρόλα αυτά τα γραμμικά μοντέλα μπορούν να πετύχουν τα παρακάτω. Το τελικό κριτήριο επιλογής αυτών είναι πάλι το AIC με βάση το σφάλμα NRMSE. Στα διαγράμματα [19] δείχνουμε τα κριτήρια αυτά για τα υποψήφια μοντέλα. 

AIC για τα υποψήφια AR μοντέλα | AIC για τα υποψήφια MA μοντέλα
:-------------------------:|:-------------------------:
![AIC για τα υποψήφια AR μοντέλα](../assets/MA_AIC_AMA2.png "AIC για τα υποψήφια AR μοντέλα"){ width=45% height=45% }  |  ![AIC για τα υποψήφια MA μοντέλα](../assets/AR_AIC_AMA2.png "AIC για τα υποψήφια MA μοντέλα"){ width=45% height=45% } 

![AIC για τα υποψήφια μοντέλα](../assets/ARMA_AIC_AMA2.png "AIC για τα υποψήφια ARMA μοντέλα"){ width=75% height=75% }

Από τα σχήματα του AIC για τα υποψήφια μοντέλα, παρατηρούμε ότι το μοντέλο `AR(14)` παρουσιάζει τη μικρότερη τιμή του AIC, αλλά για το πλήθος των δεδομένων ελέγχου 14 παράμετροι είναι αδύνατο να ελεγχθούν. Επιπλέον είναι πολλές παράμετροι για να χρησιμοποιήσουμε σε ένα γραμμικό μοντέλο και αυτός δεν είναι ο σκοπός της μελέτης με το κριτήριο Akaike. Αυτό σημαίνει ότι θα διαλέξουμε το μοντέλο `AR(2)` για να εξηγήσουμε τη συμπεριφορά αυτής της χρονοσειράς. Αυτό είναι ακριβώς το μοντέλο που χρησιμοποιήσαμε και στην πρώτη χρονοσειρά. Τέλος, για αυτό το μοντέλο δίνουμε το διάγραμμα που παρουσιάζει κατά πόσο μπορεί να προβλέψει μελλοντικές τιμές της εισόδου.

![Προβλέψεις τιμών για το καλύτερο μοντέλο](../assets/AR_best_pred_AMA2.png "Προβλέψεις τιμών για το καλύτερο μοντέλο"){ width=75% height=75% }

Από τα σφάλματα NRMSE βλέπουμε ότι οι προβλέψεις είναι καλύτερες για βήμα T=1 από ότι για T=2. Για T=1 προτιμούμε το μοντέλο `AR(2)` ενώ για T>2 προτιμούμε τη μέση τιμή. Οι επιδόσεις του σε αυτή τη χρονοσειρά είναι σαφώς ανώτερες αυτές της πρώτης.

#### TMI

Η ανάλυση αυτής της εξαγόμενης χρονοσειράς γίνεται όπως και στην αντίστοιχη της πρώτης. Ωστόσο, πάλι δε θα παρουσιαστεί ο κώδικας γιατί όπως έχει υπωθεί είναι ο ίδιος για όλα τα κομμάτια με διαφορά στις παραμέτρους, γιατί γράφτηκε σύμφωνα με τα πρότυπα του δομημένου προγραμματισμού.

Το πολυώνυμο που προσεγγίζει την χρονοσειρά για τη μετέπειτα αφαίρεση της τάσης έχει δύο τελευταίους όρους ίσους με:
- γραμμικός: $4.6583853\times 10^{-5}$
- σταθερός: $0.131$ 


Επίσης, δε φαίνεται να έχει εποχικότητα για να χρειαστεί η μέθοδος των διαφορών.
Τα διαγράμματα που προκύπτουν είναι τα εξής:

![Συνάρτηση αυτοσυσχέτισης](../assets/autocorrelation_TMI2.png "Συνάρτηση αυτοσυσχέτισης"){ width=75% height=75% }

![Συνάρτηση μερικής αυτοσυσχέτισης](../assets/partial_autocorrelations_TMI2.png "Συνάρτηση μερικής αυτοσυσχέτισης"){ width=75% height=75% }

Οι συσχετίσεις για αρκετές παρελθοντικές τιμές είναι ισχυρές σύμφωνα με τη συνάρτηση αυτοσυσχέτισης, όπως και οι μερικές αυτοσυσχετίσεις. Αυτό είναι παρόμοιο με την TMI της πρώτης χρονοσειράς. Μόνο που στην TMI της πρώτης χρονοσειράς πολλές μερικές αυτοσυσχετίσεις ήταν στο όριο να θεωρηθούν στατιστικά ασήμαντες. Το μοντέλο που περιγράφει αυτή τη χρονοσειρά καλύτερα φαίνεται παρακάτω στα σχήματα, όπως φαίνονται και τα κριτήρια με τα οποία το εξάγαμε.


AIC για τα υποψήφια AR μοντέλα | AIC για τα υποψήφια MA μοντέλα
:-------------------------:|:-------------------------:
![AIC για τα υποψήφια AR μοντέλα](../assets/MA_AIC_TMI2.png "AIC για τα υποψήφια AR μοντέλα"){ width=45% height=45% }  |  ![AIC για τα υποψήφια MA μοντέλα](../assets/AR_AIC_TMI2.png "AIC για τα υποψήφια MA μοντέλα"){ width=45% height=45% } 

![AIC για τα υποψήφια μοντέλα](../assets/ARMA_AIC_TMI2.png "AIC για τα υποψήφια ARMA μοντέλα"){ width=75% height=75% }

Από ότι βλέπουμε το καλύτερο μοντέλο που είναι και αρκετά απλό για να το εξετάσουμε σε ένα σετ ελέγχου είναι το `ARMA(2,3)`. 

![Προβλέψεις τιμών για το καλύτερο μοντέλο](../assets/ARMA_best_pred_TMI2.png "Προβλέψεις τιμών για το καλύτερο μοντέλο"){ width=75% height=75% }

Παραδόξως όμως η πρόβλεψη είναι καλύτερη από ότι αν είχαμε πρόβλεψη χρησιμοποιώντας τη μέση τιμή ακόμα και στα δύο χρονικά βήματα. Αυτό δείχνει ότι το μοντέλο `ARMA(2,3)` προσεγγίζει σχετικά καλά την χρονοσειρά. Επίσης, είναι καλύτερη από ότι η αντίστοιχη καλύτερη στην πρώτη χρονοσειρά.

\ 

Ο κώδικας του αρχείου `LINEAR2.m` για την υλοποίηση της ανάλυσης της δεύτερης χρονοσειράς δίνεται παρακάτω:


#### Ο κώδικας του αρχείου `LINEAR2.m`:

```matlab
DST_NUM = '2nd';
if(BASIC_PLOT)
    f = figure();
    plot(T, X2);
    saveas(f, sprintf('assets/basic_plot_%s.png', DST_NUM));
    title(sprintf('%s time series', DST_NUM));
    xlabel('time-step');
    ylabel('eye-position');       
end
% see if the signal has information
% if voids and non-voids exist inside it
% then there is information.
% plot(T, log(abs(X1) + eps));
% Y1 = log(abs(X1(2:end))) - log(abs(X1(1:LENGTH-1)));
% plot(T(1:end-1), Y1)

filterorder = 5;
% we tested 30, 20, 10, 5
% 5 is much more promising...
nsam = 5;
timesep = 5;
% get EXTREMA SERIES 
[AMA, AMI, AMD, TMA, TMI, TBP] = produce_time_series(X2, Ts, filterorder, nsam, timesep, EXTREMA_PLOT, EXTREMA_SERIES_PLOT, FIR, DST_NUM);

% all linear analysis for AMA
linear_analysis(AMA, 'AMA2', MAX_ORDER_AR, MAX_ORDER_MA, POLORDER, ...
                EXTREMA_PLOT, EXTREMA_SERIES_PLOT, REMOVES_TREND, REMOVES_TREND_PLOT, AUTOCORR_PLOT, AKAIKE, DST_NUM);


% all linear analysis for TMI
linear_analysis(TMI, 'TMI2', MAX_ORDER_AR, MAX_ORDER_MA, POLORDER, ...
                EXTREMA_PLOT, EXTREMA_SERIES_PLOT, REMOVES_TREND, REMOVES_TREND_PLOT, AUTOCORR_PLOT, AKAIKE, DST_NUM);
```

