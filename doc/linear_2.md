## Γραμμική ανάλυση 2ης χρονοσειράς
Η δεύτερη χρονοσειρά όπως φαίνεται από το διαγραμμά της φαίνεται ότι έχει κάποια ανοδική τάση. Οπότε μάλλον ο ασθενής εδώ ξεγιελιέται και πρόκειται πραγματικά για ασθενή (υτό θα φανεί και αργότερα, αλλά χωρίς επαρκή ανάλυση δεν θα μπορούσαμε να υποστηρίξουμε κάτι τέτοιο). Επίσης, σίγουρα δεν υπάρχει μόνο θόρυβος. Από αυτά εκτιμάμε ότι η χρονοσειρά έχει πληροφορία που χαρακτηρίζει τον ασθενή. Στο Σχήμα [16]φαίνονται σε χρονική σειρά οι 6000 τιμές του σήματος που λάβαμε από το δεύτερο πείραμα.

![16](../assets/basic_plot_2nd.png "Χρονοσειρά 2")

Όπως φαίνεται σε αυτή τη χρονοσειρά ο ασθενής συνεχώς ξεγιελιέται και σπάνια (3 φορές) επανέρχεται, αλλά και πάλι όχι πλήρως. Δηλαδή το μάτι δεν παίρνει την ίδια θέση που είχε πριν. Στο υπόλοιπο της γραμμικής μελέτης αυτής της χρονοσειράς, χρησιμοποιούμε τα εργαλεία του μαθήματος και συγκρίνουμε τη μελέτη με αυτή της πρώτης.

### Εξαγωγή χρονοσειράς μελέτης
Με βάση τη συνάρτηση `extremes.m` που μας δόθηκε εξάγαμε και πάλι όλες τις χρονοσειρές των τοπικών ακροτάτων που μπορεί κανείς να τις δει στα Σχήματα [17] και [18]. Επίσης, δίνονται και τα ορίσματα της συνάρτησης `extremes` τα οποία εξάγαμε μετά από αρκετό πειραματισμό.
```matlab
filterorder = 5;
nsam = 5;
timesep = 5;
``` 
Όπως και στην πρώτη χρονοσειρά, έτσι και εδώ ενδιαφερόμαστε περισσότερο για τις χρονοσειρές `AMA` και `TMI`. Μετά από ελέγχους ύπαρξης πληροφορίας Portmanteu καταλήγουμε και πάλι ότι αυτές οι δύο έχουν πληροφορία και δεν προσεγγίζονται μόνο από τον λευκό θόρυβο. Στα σχήματα [17] και [18] δίνονται τα διαγράμματα των χρονοσειρών πλάτους και χρονικών περιθωρίων.

![17](../assets/AM_plot_2nd.png  "Χρονοσειρές πλάτους")


![18](../assets/TM_plot_2nd.png "Χρονοσειρές χρόνου")

### Κυρίως γραμμική ανάλυση
#### AMA
Στο πρώτο μέρος της γραμμικής ανάλυσης θα αναφερθούμε στη χρονοσειρά AMA που εξάγαμε. Το πρώτο μέγεθος που υπολογίσαμε για αυτήν ήταν η τάση της. Αυτό το κάναμε χρησιμοποιώντας πάλι ένα πολυώνυμο. Το τελικό πολυώνυμο έδειξε ότι η σταθερός όρος της τάσης είναι ίσος με `-7.7080776`ενώ ο γραμμικός συντελεστής της `0.33391515`. Οι υπόλοιποι 3 συντελεστές αυτού του πολυωνύμου ωστόσο δεν ακυρώνουν την γραμμική τάση μετά από λίγα χρονικά βήματα όπως στην πρώτη χρονοσειρά. Δηλαδή επιβεβαιώνουν την ύπαρξη ανοδικής τάσης.

Μετά υπολογίσαμε και κάναμε τα γραφήματα της συνάρτησης αυτοσυσχέτισης και μερικής αυτοσυσχέτισης. Στα σχήματα [19] και [20] φαίνονται τα διαγράμματα αυτά.

![19](../assets/autocorrelation_AMA2.png "Συνάρτηση αυτοσυσχέτισης")

![20](../assets/partial_autocorrelations_AMA2.png "Συνάρτηση μερικής αυτοσυσχέτισης")

Από τις αυτοσυσχετίσεις βλέπουμε ότι τα δεδομένα έχουν έμμεση συσχέτιση μέχρι και μεγάλες τιμές του $\tau$. Ωστόσο, οι μερικές αυτοσυσχετίσεις δείχνουν ότι οι μακρινές (σε χρονικά βήματα) τιμές δεν είναι άμεσα συσχετιζόμενες με την τωρινή. Αυτή είναι και μία μεγάλη ομοιότητα μεταξύ αυτής της AMA χρονοσειράς και της πρώτης AMA χρονοσειράς. Η πρώτη φαινόταν ότι μπορεί να προσεγγιστεί γραμμικά, ωστόσο αυτή όχι.

Παρόλα αυτά τα γραμμικά μοντέλα μπορούν να πετύχουν τα παρακάτω. Το τελικό κριτήριο επιλογής αυτών είναι πάλι το AIC με βάση το σφάλμα NRMSE. Στα διαγράμματα [21],[22],[23] δείχνουμε τα κριτήρια αυτά για τα υποψήφια μοντέλα. 

AIC για τα υποψήφια AR μοντέλα | AIC για τα υποψήφια MA μοντέλα
:-------------------------:|:-------------------------:
![21](../assets/MA_AIC_AMA2.png "AIC για τα υποψήφια AR μοντέλα")  |  ![22](../assets/AR_AIC_AMA2.png "AIC για τα υποψήφια MA μοντέλα") 
---
![23](../assets/ARMA_AIC_AMA2.png "AIC για τα υποψήφια ARMA μοντέλα")

Από τα σχήματα του AIC για τα υποψήφια μοντέλα, παρατηρούμε ότι το μοντέλο `AR(2)` παρουσιάζει τη μικρότερη τιμή του AIC. Αυτό σημαίνει ότι θα διαλέξουμε το μοντέλο `AR(2)` για να εξηγήσουμε τη συμπεριφορά αυτής της χρονοσειράς. Αυτό είναι ακριβώς το μοντέλο που χρησιμοποιήσαμε και στην πρώτη χρονοσειρά. Τέλος για αυτό το μοντέλο δίνουμε το διάγραμμα που παρουσιάζει κατά πόσο μπορεί να προβλέψει μελλοντικές τιμές της εισόδου.

![24](../assets/AR_best_pred_AMA2.png "Προβλέψεις τιμών για το καλύτερο μοντέλο")

Από τα σφάλματα NRMSE βλέπουμε ότι οι προβλέψεις είναι καλύτερες για βήμα T=1 από ότι για T=2. Για T=1 προτιμούμε το μοντέλο `AR(2)` ενώ για T>2 προτιμούμε τη μέση τιμή. Οι επιδόσεις του σε αυτή τη χρονοσειρά είναι σαφώς ανώτερες αυτές της πρώτης.

#### TMI
Η ανάλυση αυτής της εξαγόμενης χρονοσειράς γίνεται όπως και στην αντίστοιχη της πρώτης. Ωστόσο, πάλι δε θα παρουσιαστεί ο κώδικας γιατί όπως έχει υπωθεί είναι ο ίδιος για όλα τα κομμάτια με διαφορά στις παραμέτρους, γιατί γράφτηκε σύμφωνα με τα πρότυπα του δομημένου προγραμματισμού.

Το πολυώνυμο που προσεγγίζει την χρονοσειρά για τη μετέπειτα αφαίρεση της τάσης έχει δύο τελευταίους όρους ίσους με:
-  γραμμικός: $4.6583853 \sdot 10^{-5}$
-  σταθερός: $0.131$ 


Επίσης, δε φαίνεται να έχει εποχικότητα για να χρειαστεί η μέθοδος των διαφορών.
Τα διαγράμματα που προκύπτουν είναι τα εξής:

![25](../assets/autocorrelation_TMI2.png "Συνάρτηση αυτοσυσχέτισης")

![26](../assets/partial_autocorrelations_TMI2.png "Συνάρτηση μερικής αυτοσυσχέτισης")

Πάλι οι συσχετίσεις για αρκετές παρελθοντικές τιμές είναι σθεναρές σύμφωνα με τη συνάρτηση αυτοσυσχέτισης, αλλά οι άμεσες συσχετίσεις είναι οριακά σημαντικές σύμφωνα με τη συνάρτηση μερικής αυτοσυσχέτισης. Αυτό είναι παρόμοιο με την TMI της πρώτης χρονοσειράς. Το μοντέλο που περιγράφει αυτή τη χρονοσειρά καλύτερα φαίνεται παρακάτω στα σχήματα, όπως φαίνονται και τα κριτήρια με τα οποία το εξάγαμε.


AIC για τα υποψήφια AR μοντέλα | AIC για τα υποψήφια MA μοντέλα
:-------------------------:|:-------------------------:
![27](../assets/MA_AIC_TMI2.png "AIC για τα υποψήφια AR μοντέλα")  |  ![28](../assets/AR_AIC_TMI2.png "AIC για τα υποψήφια MA μοντέλα") 
---
![29](../assets/ARMA_AIC_TMI2.png "AIC για τα υποψήφια ARMA μοντέλα")


![30](../assets/ARMA_best_pred_TMI2.png "Προβλέψεις τιμών για το καλύτερο μοντέλο")

Παραδόξως όμως η πρόβλεψη είναι καλύτερη από ότι αν είχαμε πρόβλεψη χρησιμοποιώντας τη μέση τιμή ακόμα και στα δύο χρονικά βήματα. Αυτό δείχνει ότι το μοντέλο `ARMA(2,3)` προσεγγίζει σχετικά καλά την χρονοσειρά.

Ο κώδικας του αρχείου `LINEAR2.m` για την υλοποίηση της ανάλυσης της δεύτερης χρονοσειράς δίνεται παρακάτω:


Ο κώδικας του αρχείου `LINEAR2.m`:
```matlab
DST_NUM = '2nd';
if(BASIC_PLOT)
    f = figure();
    plot(T, X2);
    saveas(f, sprintf('assets/basic_plot_%s.png', DST_NUM));
    title(sprintf('%s time series', DST_NUM));
    xlabel('time-step');
    ylabel('eye-position');       
end
% see if the signal has information
% if voids and non-voids exist inside it
% then there is information.
% plot(T, log(abs(X1) + eps));
% Y1 = log(abs(X1(2:end))) - log(abs(X1(1:LENGTH-1)));
% plot(T(1:end-1), Y1)

filterorder = 5;
% we tested 30, 20, 10, 5
% 5 is much more promising...
nsam = 5;
timesep = 5;
% get EXTREMA SERIES 
[AMA, AMI, AMD, TMA, TMI, TBP] = produce_time_series(X2, Ts, filterorder, nsam, timesep, EXTREMA_PLOT, EXTREMA_SERIES_PLOT, FIR, DST_NUM);

% all linear analysis for AMA
linear_analysis(AMA, 'AMA2', MAX_ORDER_AR, MAX_ORDER_MA, POLORDER, ...
                EXTREMA_PLOT, EXTREMA_SERIES_PLOT, REMOVES_TREND, REMOVES_TREND_PLOT, AUTOCORR_PLOT, AKAIKE, DST_NUM);


% all linear analysis for TMI
linear_analysis(TMI, 'TMI2', MAX_ORDER_AR, MAX_ORDER_MA, POLORDER, ...
                EXTREMA_PLOT, EXTREMA_SERIES_PLOT, REMOVES_TREND, REMOVES_TREND_PLOT, AUTOCORR_PLOT, AKAIKE, DST_NUM);
```